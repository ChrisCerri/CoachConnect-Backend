server {
    listen 80; # Nginx ascolterà sulla porta 80 all'interno del container
    server_name localhost; # Può essere il tuo dominio, per sviluppo 'localhost' va bene

    # La root dei file per Nginx è la cartella 'public' di Laravel
    root /var/www/html/public;

    # Intestazioni di sicurezza comuni
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Content-Type-Options "nosniff";

    # File di indice che Nginx dovrebbe cercare
    index index.html index.htm index.php;

    charset utf-8;

    # Gestione delle richieste:
    # Prova a servire il file richiesto ($uri) o la directory ($uri/).
    # Se non trova né l'uno né l'altro, passa la richiesta a index.php (per le rotte di Laravel).
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Configurazione per il passaggio delle richieste PHP a PHP-FPM
    location ~ \.php$ {
        # 'php-fpm' è il nome del servizio PHP nel tuo docker-compose.yml
        # La porta 9000 è quella esposta dal container PHP-FPM
        fastcgi_pass php-fpm:9000;
        fastcgi_index index.php;
        # Imposta il percorso assoluto dello script PHP all'interno del container
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params; # Include i parametri FastCGI standard

        # Alcuni altri parametri utili, se necessari per il tuo setup Laravel
        # fastcgi_buffer_size 128k;
        # fastcgi_buffers 4 256k;
        # fastcgi_busy_buffers_size 256k;
    }

    # Blocco dell'accesso a file sensibili (come il file .env)
    location ~ /\.env {
        deny all;
    }

    # Blocco dell'accesso ai file nascosti di Apache (come .htaccess)
    location ~ /\.ht {
        deny all;
    }
}